% Parámetros iniciales:
    ho = 120; % W / m2K
    hoo = 25; % W / m2K
    To = 1000; % C
    Too = 15; % C
    K = 5; % W / mk
    Lancho = 2.8;
    Lalto = 2;
    dy = Lancho / 14; % m
    dx = dy; % m
    qgen = 10000; % w/m3
    
% Parámetros calculados y usados con frecuencia
    qdx2k = qgen * dx^2 / K; % W / m3 * m2 / K = W / mK
    hodxk = ho * dx / K; % W / m2K * m / W / mk : Adimensional
    hoodxk = hoo * dx / K; % W / m2K * m / W / mk : Adimensional

% Coeficientes de temperatura de nodos e igualdades de temperatura:
    % Ni = [                    T01, T02, T03, T04 ...
    %                           T05, T06, T07, T08 ...
    %       T09, T10, T11, T12, T13, T14, T15, T16 ...
    %       T17, T18, T19, T20, T21, T22, T23, T24 ...
    %       T25, T26, T27, T28, T29, T30, T31, T32];

    % N1: Nodo esquina convectiva - T(m, n-1) + T(m+1, n) - (2 + hodxk)*T(m,n) = -hodxk - qdx2k / 2
    % T5 + T2 - (2 + hodxk)*T1 = -hodxk*To - qdx2k / 2
    N1 = [            -2 - hodxk, 1, 0, 0 ...
                      1, 0, 0, 0 ...
          0, 0, 0, 0, 0, 0, 0, 0 ...
          0, 0, 0, 0, 0, 0, 0, 0 ...
          0, 0, 0, 0, 0, 0, 0, 0];
    D1 = -hodxk*To - qdx2k / 2;
    % N2: Nodo adiabático - "Dos veces el de atrás más una vez cada lado" - 4T(m, n) = -qdx2k
    % 2T6 + T1 + T3 - 4T2 = -qdx2k
    N2 = [            1, -4, 1, 0 ...
                      0, 2, 0, 0 ...
          0, 0, 0, 0, 0, 0, 0, 0 ...
          0, 0, 0, 0, 0, 0, 0, 0 ...
          0, 0, 0, 0, 0, 0, 0, 0];
    D2 = -qdx2k;
    % N3: Nodo adiabático - "Dos veces el de atrás más una vez cada lado" - 4T(m, n) = -qdx2k
    % 2T7 + T2 + T4 - 4T3 = -qdx2k
    N3 = [            0, 1, -4, 1 ... 
                      0, 0, 2, 0 ...
          0, 0, 0, 0, 0, 0, 0, 0 ...
          0, 0, 0, 0, 0, 0, 0, 0 ...
          0, 0, 0, 0, 0, 0, 0, 0];
    D3 = -qdx2k;
    % N4: Nodo esquina adiabático: T(m-1, n) - T(m, n-1) - 2T(m,n) = -qdx2k / 2
    % T3 - T8 - 2T4 = -qdx2k / 2
    N4 = [            0, 0, 1, -2 ...
                      0, 0, 0, 1 ...
          0, 0, 0, 0, 0, 0, 0, 0 ...
          0, 0, 0, 0, 0, 0, 0, 0 ...
          0, 0, 0, 0, 0, 0, 0, 0];
    D4 = -qdx2k / 2;
    % N5: Nodo convectivo interno - "Dos veces el de atrás más una vez cada lado" - (4 + 2hodxk)*T(m, n) = -qdx2k - 2hodxk
    % 2T6 + T1 + T13 - (4 + 2hodxk)*T5 = -qdx2k - 2hodxk * To
    N5 = [            1, 0, 0, 0 ... 
                      -4 - 2*hodxk, 2, 0, 0 ... 
          0, 0, 0, 0, 1, 0, 0, 0 ...
          0, 0, 0, 0, 0, 0, 0, 0 ...
          0, 0, 0, 0, 0, 0, 0, 0];
    D5 = -qdx2k - 2*hodxk*To;
    % N6: Nodo interno - T(m-1, n) + T(m+1, n) + T(m, n-1) + T(m, n+1) - 4T(m, n) = -qdx2k
    % T2 + T5 + T7 + T14 - 4T6 = -qdx2k
    N6 = [            0, 1, 0, 0 ... 
                      1, -4, 1, 0 ... 
          0, 0, 0, 0, 0, 1, 0, 0 ...  
          0, 0, 0, 0, 0, 0, 0, 0 ...
          0, 0, 0, 0, 0, 0, 0, 0];
    D6 = -qdx2k;
    % N7: Nodo interno - T(m-1, n) + T(m+1, n) + T(m, n-1) + T(m, n+1) - 4T(m, n) = -qdx2k
    % T3 + T6 + T8 + T15 - 4T7 = -qdx2k
    N7 = [            0, 0, 1, 0 ... 
                      0, 1, -4, 1 ... 
          0, 0, 0, 0, 0, 0, 1, 0 ...  
          0, 0, 0, 0, 0, 0, 0, 0 ...
          0, 0, 0, 0, 0, 0, 0, 0];
    D7 = -qdx2k;
    % N8: Nodo adiabático - "Dos veces el de atrás más una vez cada lado" - 4T(m, n) = -qdx2k
    % 2T7 + T4 + T16 - 4T8 = -qdx2k
    N8 = [            0, 0, 0, 1 ...
                      0, 0, 2, -4 ...
          0, 0, 0, 0, 0, 0, 0, 1 ...
          0, 0, 0, 0, 0, 0, 0, 0 ...
          0, 0, 0, 0, 0, 0, 0, 0];
    D8 = -qdx2k;
    % N9: Nodo esquina convectiva - T(m, n-1) + T(m+1, n) - (2 + hodxk)*T(m,n) = -hodxk - qdx2k / 2
    % T17 + T10 - (2 + hodxk)*T1 = -hodxk - qdx2k / 2
    N9 = [            0, 0, 0, 0 ...
                      0, 0, 0, 0 ...
          -2 - hodxk, 1, 0, 0, 0, 0, 0, 0 ...
          1, 0, 0, 0, 0, 0, 0, 0 ...
          0, 0, 0, 0, 0, 0, 0, 0];
    D9 = -hodxk*To - qdx2k / 2;
    % N10: Nodo convectivo interno - "Dos veces el de atrás más una vez cada lado" - (4 + 2hodxk)*T(m, n) = -qdx2k - 2hodxk
    % 2T18 + T9 + T11 - (4 + 2hodxk)*T10 = -qdx2k -2hodxk*To
    N10 = [            0, 0, 0, 0 ...
                       0, 0, 0, 0 ...
           1, -4 - 2*hodxk, 1, 0, 0, 0, 0, 0 ...
           0, 2, 0, 0, 0, 0, 0, 0 ...
           0, 0, 0, 0, 0, 0, 0, 0];
    D10 = -qdx2k - 2*hodxk*To;
    % N11: Nodo convectivo interno - "Dos veces el de atrás más una vez cada lado" - (4 + 2hodxk)*T(m, n) = -qdx2k - 2hodxk
    % 2T19 + T10 + T12 - (4 + 2hodxk)*T10 = -qdx2k -2hodxk*To
    N11 = [            0, 0, 0, 0 ...
                       0, 0, 0, 0 ...
           0, 1, -4 - 2*hodxk, 1, 0, 0, 0, 0 ...
           0, 0, 2, 0, 0, 0, 0, 0 ...
           0, 0, 0, 0, 0, 0, 0, 0];
    D11 = -qdx2k - 2*hodxk*To;
    % N12: Nodo convectivo interno - "Dos veces el de atrás más una vez cada lado" - (4 + 2hodxk)*T(m, n) = -qdx2k - 2hodxk
    % 2T20 + T11 + T13 - (4 + 2hodxk)*T10 = -qdx2k -2hodxk*To
    N12 = [            0, 0, 0, 0 ...
                       0, 0, 0, 0 ...
           0, 0, 1, -4 - 2*hodxk, 1, 0, 0, 0 ...
           0, 0, 0, 2, 0, 0, 0, 0 ...
           0, 0, 0, 0, 0, 0, 0, 0];
    D12 = -qdx2k - 2*hodxk*To;
    % N13: Nodo esquina interna convectiva - T(m-1, n) + 2*T(m+1, n) + T(m, n+1) + 2*T(m, n-1) - (6 + 2*hodxk)*T(m,n) = -2hodxk - 3qdx2k/2
    % T12 + 2*T14 + T5 + 2*T21 - (6 + 2*hodxk)*T13 = -2hodxk - 3qdx2k/2
    N13 = [            0, 0, 0, 0 ...
                       1, 0, 0, 0 ...
           0, 0, 0, 1, -6 - 2*hodxk, 2, 0, 0 ...
           0, 0, 0, 0, 2, 0, 0, 0 ...
           0, 0, 0, 0, 0, 0, 0, 0];
    D13 = -2*hodxk*To - (3/2)*qdx2k;
    % N14: Nodo interno - T(m-1, n) + T(m+1, n) + T(m, n-1) + T(m, n+1) - 4T(m, n) = -qdx2k
    % T6 + T13 + T15 + T22 - 4T14 = -qdx2k
    N14 = [            0, 0, 0, 0 ... 
                       0, 1, 0, 0 ... 
           0, 0, 0, 0, 1, -4, 1, 0 ...
           0, 0, 0, 0, 0, 1, 0, 0 ...
           0, 0, 0, 0, 0, 0, 0, 0];
    D14 = -qdx2k;
    % N15: Nodo interno - T(m-1, n) + T(m+1, n) + T(m, n-1) + T(m, n+1) - 4T(m, n) = -qdx2k
    % T14 + T16 + T7 + T23 - 4T15 = -qdx2k 
    N15 = [            0, 0, 0, 0 ... 
                       0, 0, 1, 0 ... 
           0, 0, 0, 0, 0, 1, -4, 1 ...
           0, 0, 0, 0, 0, 0, 1, 0 ...
           0, 0, 0, 0, 0, 0, 0, 0];
    D15 = -qdx2k;
    % N16: Nodo adiabático - "Dos veces el de atrás más una vez cada lado" - 4T(m, n) = -qdx2k
    % 2T15 + T8 + T24 - 4T16 = -qdx2k
    N16 = [            0, 0, 0, 0 ...
                       0, 0, 0, 1 ...
           0, 0, 0, 0, 0, 0, 2, -4 ...
           0, 0, 0, 0, 0, 0, 0, 1 ...
           0, 0, 0, 0, 0, 0, 0, 0];
    D16 = -qdx2k;
    % N17: Nodo adiabático - "Dos veces el de atrás más una vez cada lado" - 4T(m, n) = -qdx2k
    % 2T18 + T9 + T25 - 4T17 = -qdx2k
    N17 = [            0, 0, 0, 0 ...
                       0, 0, 0, 0 ...
           1, 0, 0, 0, 0, 0, 0, 0 ...
           -4, 2, 0, 0, 0, 0, 0, 0 ...
           1, 0, 0, 0, 0, 0, 0, 0];
    D17 = -qdx2k;
    % N18: Nodo interno - T(m-1, n) + T(m+1, n) + T(m, n-1) + T(m, n+1) - 4T(m, n) = -qdx2k
    % T17 + T19 + T10 + T26 - 4T18 = -qdx2k
    N18 = [            0, 0, 0, 0 ... 
                       0, 0, 0, 0 ... 
           0, 1, 0, 0, 0, 0, 0, 0 ...
           1, -4, 1, 0, 0, 0, 0, 0 ...
           0, 1, 0, 0, 0, 0, 0, 0];
    D18 = -qdx2k;
    % N19: Nodo interno - T(m-1, n) + T(m+1, n) + T(m, n-1) + T(m, n+1) - 4T(m, n) = -qdx2k
    % T18 + T20 + T11 + T27 - 4T19 = -qdx2k
    N19 = [            0, 0, 0, 0 ... 
                       0, 0, 0, 0 ... 
           0, 0, 1, 0, 0, 0, 0, 0 ...
           0, 1, -4, 1, 0, 0, 0, 0 ...
           0, 0, 1, 0, 0, 0, 0, 0];
    D19 = -qdx2k;
    % N20: Nodo interno - T(m-1, n) + T(m+1, n) + T(m, n-1) + T(m, n+1) - 4T(m, n) = -qdx2k
    % T19 + T21 + T12 + T28 - 4T20 = -qdx2k
    N20 = [            0, 0, 0, 0 ... 
                       0, 0, 0, 0 ... 
           0, 0, 0, 1, 0, 0, 0, 0 ...
           0, 0, 1, -4, 1, 0, 0, 0 ...
           0, 0, 0, 1, 0, 0, 0, 0];
    D20 = -qdx2k;
    % N21: Nodo interno - T(m-1, n) + T(m+1, n) + T(m, n-1) + T(m, n+1) - 4T(m, n) = -qdx2k
    % T20 + T22 + T13 + T29 - 4T21 = -qdx2k
    N21 = [            0, 0, 0, 0 ... 
                       0, 0, 0, 0 ... 
           0, 0, 0, 0, 1, 0, 0, 0 ...
           0, 0, 0, 1, -4, 1, 0, 0 ...
           0, 0, 0, 0, 1, 0, 0, 0];
    D21 = -qdx2k;
    % N22: Nodo interno - T(m-1, n) + T(m+1, n) + T(m, n-1) + T(m, n+1) - 4T(m, n) = -qdx2k
    % T21 + T23 + T14 + T30 - 4T22 = -qdx2k
    N22 = [            0, 0, 0, 0 ... 
                       0, 0, 0, 0 ... 
           0, 0, 0, 0, 0, 1, 0, 0 ...
           0, 0, 0, 0, 1, -4, 1, 0 ...
           0, 0, 0, 0, 0, 1, 0, 0];
    D22 = -qdx2k;
    % N23: Nodo interno - T(m-1, n) + T(m+1, n) + T(m, n-1) + T(m, n+1) - 4T(m, n) = -qdx2k
    % T22 + T24 + T15 + T31 - 4T23 = -qdx2k
    N23 = [            0, 0, 0, 0 ... 
                       0, 0, 0, 0 ... 
           0, 0, 0, 0, 0, 0, 1, 0 ...
           0, 0, 0, 0, 0, 1, -4, 1 ...
           0, 0, 0, 0, 0, 0, 1, 0];
    D23 = -qdx2k;
    % N24: Nodo adiabático - "Dos veces el de atrás más una vez cada lado" - 4T(m, n) = -qdx2k
    % 2T23 + T16 + T32 - 4T24 = -qdx2k
    N24 = [            0, 0, 0, 0 ... 
                       0, 0, 0, 0 ...
           0, 0, 0, 0, 0, 0, 0, 1 ...
           0, 0, 0, 0, 0, 0, 2, -4 ...
           0, 0, 0, 0, 0, 0, 0, 1];
    D24 = -qdx2k;
    % N25: Nodo esquina externa convectiva - T(m+1, n) + T(m, n+1) - (2 + hoodxk)*T(m, n) = -hoodxk - qdx2k / 2
    % T26 + T17 - (2 + hoodxk)*T25 = -hoodxk*Too - qdx2k / 2
    N25 = [            0, 0, 0, 0 ... 
                       0, 0, 0, 0 ...
           0, 0, 0, 0, 0, 0, 0, 0 ...
           1, 0, 0, 0, 0, 0, 0, 0 ...
           -2 - hoodxk, 1, 0, 0, 0, 0, 0, 0];
    D25 = -hoodxk*Too - qdx2k / 2;
    % N26: Nodo convectivo externo - "Dos veces el de atrás más una vez cada lado" - (4 + 2hoodxk)*T(m, n) = -qdx2k - 2hoodxk
    % 2T18 + T25 + T27 - (4 + 2hoodxk)*T26 = -qdx2k - 2hoodxk*Too
    N26 = [            0, 0, 0, 0 ...
                       0, 0, 0, 0 ...
           0, 0, 0, 0, 0, 0, 0, 0 ...
           0, 2, 0, 0, 0, 0, 0, 0 ...
           1, -4 - 2*hoodxk, 1, 0, 0, 0, 0, 0];
    D26 = -qdx2k - 2*hoodxk*Too;
    % N27: Nodo convectivo externo - "Dos veces el de atrás más una vez cada lado" - (4 + 2hoodxk)*T(m, n) = -qdx2k - 2hoodxk
    % 2T19 + T26 + T28 - (4 + 2hoodxk)*T27 = -qdx2k - 2hoodxk*Too
    N27 = [            0, 0, 0, 0 ... 
                       0, 0, 0, 0 ...
           0, 0, 0, 0, 0, 0, 0, 0 ...
           0, 0, 2, 0, 0, 0, 0, 0 ...
           0, 1, -4 - 2*hoodxk, 1, 0, 0, 0, 0];
    D27 = -qdx2k - 2*hoodxk*Too;
    % N28: Nodo convectivo externo - "Dos veces el de atrás más una vez cada lado" - (4 + 2hoodxk)*T(m, n) = -qdx2k - 2hoodxk
    % 2T20 + T27 + T29 - (4 + 2hoodxk)*T28 = -qdx2k - 2hoodxk*Too
    N28 = [            0, 0, 0, 0 ... 
                       0, 0, 0, 0 ...
           0, 0, 0, 0, 0, 0, 0, 0 ...
           0, 0, 0, 2, 0, 0, 0, 0 ...
           0, 0, 1, -4 - 2*hoodxk, 1, 0, 0, 0];
    D28 = -qdx2k - 2*hoodxk*Too;
    % N29: Nodo convectivo externo - "Dos veces el de atrás más una vez cada lado" - (4 + 2hoodxk)*T(m, n) = -qdx2k - 2hoodxk
    % 2T21 + T28 + T30 - (4 + 2hoodxk)*T29 = -qdx2k - 2hoodxk*Too 
    N29 = [            0, 0, 0, 0 ...
                       0, 0, 0, 0 ...
           0, 0, 0, 0, 0, 0, 0, 0 ...
           0, 0, 0, 0, 2, 0, 0, 0 ...
           0, 0, 0, 1, -4 - 2*hoodxk, 1, 0, 0];
    D29 = -qdx2k - 2*hoodxk*Too; 
    % N30: Nodo convectivo externo - "Dos veces el de atrás más una vez cada lado" - (4 + 2hoodxk)*T(m, n) = -qdx2k - 2hoodxk
    % 2T22 + T29 + T31 - (4 + 2hoodxk)*T30 = -qdx2k - 2hoodxk*Too
    N30 = [            0, 0, 0, 0 ...
                       0, 0, 0, 0 ...
           0, 0, 0, 0, 0, 0, 0, 0 ...
           0, 0, 0, 0, 0, 2, 0, 0 ...
           0, 0, 0, 0, 1, -4 - 2*hoodxk, 1, 0];
    D30 = -qdx2k - 2*hoodxk*Too; 
    % N31: Nodo convectivo externo - "Dos veces el de atrás más una vez cada lado" - (4 + 2hoodxk)*T(m, n) = -qdx2k - 2hoodxk
    % 2T23 + T30 + T32 - (4 + 2hoodxk)*T31 = -qdx2k - 2hoodxk*Too
    N31 = [            0, 0, 0, 0 ...
                       0, 0, 0, 0 ...
           0, 0, 0, 0, 0, 0, 0, 0 ...
           0, 0, 0, 0, 0, 0, 2, 0 ...
           0, 0, 0, 0, 0, 1, -4 - 2*hoodxk, 1];
    D31 = -qdx2k - 2*hoodxk*Too;
    % N32: Nodo esquina externa convectiva - T(m-1, n) + T(m, n+1) - (2 + hoodxk)*T(m, n) = -hoodxk - qdx2k / 2
    % T31 + T24 - (2 + hoodxk)*T32 = -hoodxk*Too - qdx2k / 2
    N32 = [            0, 0, 0, 0 ...
                       0, 0, 0, 0 ...
           0, 0, 0, 0, 0, 0, 0, 0 ...
           0, 0, 0, 0, 0, 0, 0, 1 ...
           0, 0, 0, 0, 0, 0, 1, -2 - hoodxk];
    D32 = -hoodxk*Too - qdx2k / 2;
 
    N = [N1; N2; N3; N4; N5; N6; N7; N8; N9; N10; N11; N12; N13; N14; N15; N16; 
         N17; N18; N19; N20; N21; N22; N23; N24; N25; N26; N27; N28; N29; N30; N31; N32];

    D = [D1; D2; D3; D4; D5; D6; D7; D8; D9; D10; D11; D12; D13; D14; D15; D16; 
         D17; D18; D19; D20; D21; D22; D23; D24; D25; D26; D27; D28; D29; D30; D31; D32];

    Ninv = inv(N);
    T = N\D;
    
% Calores:
    q1 = ho*dx*Lalto*((5*To - T(10) - T(11) - T(12) - T(13) - T(5)) + 0.5*(2*To - T(1) - T(9)));
    q2 = hoo*dx*Lalto*((T(26) + T(27) + T(28) + T(29) + T(30) + T(31) - 6*Too) + 0.5*(T(25) + T(32) - 2*Too));
    Vol = Lancho * Lalto * 8 * dy - 8 * dx * Lalto * 4 * dy;
    qpunto = qgen * Vol / 4;

% Respuestas:
    for i = 1 : 32
         display("T" + i + ": " + T(i,1) + " °C");
    end

